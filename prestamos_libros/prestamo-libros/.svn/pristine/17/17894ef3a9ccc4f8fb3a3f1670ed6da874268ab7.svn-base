package com.ipartek.formacion.prestamolibros.model;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import com.ipartek.formacion.prestamolibros.pojo.Alumno;
import com.ipartek.formacion.prestamolibros.pojo.Libro;
import com.ipartek.formacion.prestamolibros.pojo.Prestamo;

public class PrestamoDAO implements CrudAble<Prestamo>{
	private static PrestamoDAO INSTANCE = null;

	private PrestamoDAO() {
		super();
	}

	public static synchronized PrestamoDAO getInstance() {
		if (INSTANCE == null) {
			INSTANCE = new PrestamoDAO();
		}
		return INSTANCE;
	}

	@Override
	public boolean insert(Prestamo pojo) throws Exception {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public List<Prestamo> getAll() throws Exception {
		ArrayList<Prestamo> prestamos = new ArrayList<Prestamo>();
		Prestamo prestamo = null;
		String sql = "{CALL `prestamoGetAll`()}";
		try (Connection con = ConnectionManager.getConnection(); CallableStatement cs = con.prepareCall(sql);) {

			try (ResultSet rs = cs.executeQuery()) {
				while (rs.next()) {
					prestamo = new Prestamo();
					
					Libro libro = new Libro();
					libro.setId(rs.getLong("id_libro"));
					libro.setTitulo(rs.getString("titulo"));
					
					Alumno alumno = new Alumno();
					alumno.setId(rs.getLong("id_alumno"));
					alumno.setNombre(rs.getString("nombre"));
					
					prestamo.setAlumno(alumno);
					prestamo.setLibro(libro);
					prestamo.setFechaInicio(rs.getDate("fecha_inicio"));
					prestamo.setFechaFin(rs.getDate("fecha_final"));

					prestamos.add(prestamo);

				}
			}
		} catch (Exception e) {
			e.printStackTrace();

		}

		return prestamos;
	}

	@Override
	public Prestamo getById(long id) throws Exception {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public boolean update(Prestamo pojo) throws Exception {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean delete(long id) throws Exception {
		// TODO Auto-generated method stub
		return false;
	}

		
	
}
